SAE J3161 (JUL 2024) Compliance Check
======================================
Simulation: SimuLTE Mode 4 â€” Base-#0 run (2026-02-17)
Standard:   SAE J3161 (R) LTE-V2X Deployment Profiles and Radio Parameters
            for Single Radio Channel Multi-Service Coexistence (Revised 2024-07)


================================================================================
1. COMPLIANT PARAMETERS
================================================================================

Parameter                    SAE J3161 Reference           Your Simulation Value
---------------------------  ----------------------------  ----------------------
adjacencyPSCCH-PSSCH         TRUE (Table 8, #15)           true
sizeSub-channel              N10 = 10 RBs (Table 8, #16)   subchannelSize = 10
numSub-channel               n10 = 10 (Table 8, #17)       numSubchannels = 10
startRB-Sub-channel          0 (Table 8, #18)              (default 0)
probResourceKeep             v0dot8 = 0.8 (Table 8, #21)   probResourceKeep = 0.8
sl-bandwidth                 N100 = 100 RBs (Table 8, #10) numRbUl = 100
maxTxPower (non-PSV)         23 dBm (Table 8, #19)         ueTxPower = 23 dBm
                                                           d2dTxPower = 23 dBm
pStep (sensing window)       100 (= 1000ms) (Table 8)      pStep = 100
selectionWindowStart (T1)    1 ms                          selectionWindowStartingSubframe = 1
maxHarqRtx                   0 (no retx)                   maxHarqRtx = 0
RLC mode                     UM (Section 8.2.7)            UM used
PDCP mode                    non-IP (Section 8.2.7)        ipBased = false
RRI                          V1 = 100ms (Table 8, #20)     rri = 1 (100ms)
Send interval (BSM)          100ms periodicity              sendInterval = 0.1s
minSubchannel-NumberPSSCH    2 (Table 11, #3)              minSubchannel = 2 (in XML)
maxSubchannel-NumberPSSCH    10 (Table 11, #4)             maxSubchannel = 10 (in XML)
allowedRetxNumberPSSCH       both (Table 11, #5)           allowedRetx = 0 (acceptable)

C_resel for RRI >= 100ms     SPSCtrMin=5, SPSCtrMax=15     intuniform(5, 15)
                             (Table 4)
C_resel for RRI = 50ms       SPSCtrMin=10, SPSCtrMax=30    intuniform(10, 30)
                             (Table 4)
C_resel for RRI = 20ms       SPSCtrMin=25, SPSCtrMax=75    intuniform(25, 75)
                             (Table 4)


================================================================================
2. NON-COMPLIANT PARAMETERS
================================================================================

------------------------------------------------------------------------------
Issue #1: MCS Range (HIGH SEVERITY)
------------------------------------------------------------------------------
SAE J3161 Reference: Table 11 (speed <120 km/h), Section 8.6
  - minMCS-PSSCH = 5 (QPSK)
  - maxMCS-PSSCH = 11 (16QAM)
  - MCS 8, 9, and 10 SHALL NOT be used (Section 8.6)

Your Simulation (sidelink_configuration.xml):
  - minMCS-PSSCH = 9
  - maxMCS-PSSCH = 16

Problem:
  - Minimum MCS of 9 forces the use of MCS values (8, 9, 10) that are
    explicitly forbidden by the standard.
  - Maximum MCS of 16 exceeds the allowed upper limit of 11.

Fix: Set minMCS-PSSCH=5, maxMCS-PSSCH=11 in sidelink_configuration.xml.
     Ensure MCS 8, 9, 10 are excluded in the MCS selection logic.

------------------------------------------------------------------------------
Issue #2: CBR-Based Congestion Control Disabled (HIGH SEVERITY)
------------------------------------------------------------------------------
SAE J3161 Reference: Table 10, Section 8.2.5
  - CBR measurement and CBR-based TX parameter adaptation are required.
  - Three CBR levels: 0.3, 0.65, and 1.0 (Table 10, #7)
  - CR-limits vary by PPPP and CBR level (Table 14)

Your Simulation (omnetpp.ini):
  - useCBR = false
  - crLimit = false
  - dccMechanism = false
  - packetDropping = false

Problem:
  - The standard requires CBR-based congestion control with CR-limiting
    and packet dropping as part of DCC. All are disabled.

Fix: Set useCBR=true, crLimit=true, packetDropping=true in omnetpp.ini.

------------------------------------------------------------------------------
Issue #3: SPS + One-Shot Not Implemented (HIGH SEVERITY)
------------------------------------------------------------------------------
SAE J3161 Reference: Section 7.3.3, Figure 15
  - "LTE-V2X shall use one-shot transmission along with SPS flow to avoid
    repetitive packet collision."
  - "SPS + one-shot shall be applied to all SPS flows generated by LTE-V2X
    radio (e.g., OBU and RSU)."
  - Requires OneShotCtr alongside ResourceReselectionCtr (Table 4):
    * OneShotCtrMin = 2, OneShotCtrMax = 6 (for RRI >= 100ms)
    * OneShotCtrMin = 4, OneShotCtrMax = 12 (for RRI = 50ms)

Your Simulation:
  - Uses SPS-only scheduling. One-Shot transmission is not implemented
    in LteMacVUeMode4.cc.

Problem:
  - Without One-Shot, the simulation cannot mitigate repetitive packet
    collisions caused by half-duplex resource reservation conflicts.

Fix: Implement the SPS + One-Shot scheme per Figure 15 flowchart.

------------------------------------------------------------------------------
Issue #4: sl-ReselectAfter Value (MEDIUM SEVERITY)
------------------------------------------------------------------------------
SAE J3161 Reference: Table 8, #22
  - sl-ReselectAfter = n6 (6 consecutive skipped SPS grants before
    triggering resource reselection)

Your Simulation (omnetpp.ini):
  - reselectAfter = 1

Problem:
  - A value of 1 triggers reselection after a single missed transmission,
    which is far more aggressive than the standard's requirement of 6.
    This causes unnecessary resource churn and may degrade performance
    under transient interference.

Fix: Set reselectAfter = 6 in omnetpp.ini (for both carNoIp and rsu).

------------------------------------------------------------------------------
Issue #5: BSM Priority / PPPP Value (MEDIUM SEVERITY)
------------------------------------------------------------------------------
SAE J3161 Reference: Table 6, Table 7
  - BSM belongs to "Critical/Essential V2V" traffic family
  - Recommended PPPP = 2 (Critical V2V) or 5 (Essential V2V)
  - PPPP ranges from 1 to 8 (lower = higher priority)
  - Minimum PPPP for Critical V2V = 2 (Table 6)

Your Simulation (Mode4App.cc, line 565):
  - lteControlInfo->setPriority(1)

Problem:
  - Priority 1 is below the minimum PPPP of 2 defined for any V2V traffic
    class. No standard V2X message type uses PPPP 1.

Fix: Set priority to 2 (Critical BSM) or 5 (Essential BSM) in Mode4App.cc.

------------------------------------------------------------------------------
Issue #6: RSSI-CBR Threshold (MEDIUM SEVERITY)
------------------------------------------------------------------------------
SAE J3161 Reference: Table 10, #4 (V2V) and Table 15, #4 (I2V)
  - threshS-RSSI-CBR = 9
  - Formula: -112 + n*2 dBm, so value 9 = -94 dBm per sub-channel

Your Simulation (omnetpp.ini):
  - thresholdRSSI = 10
  - This corresponds to -112 + 10*2 = -92 dBm

Problem:
  - 2 dB higher threshold than specified. This means the simulation
    considers fewer sub-channels as "busy", underestimating the true
    channel busy ratio (CBR).

Fix: Set thresholdRSSI = 9 in omnetpp.ini.

------------------------------------------------------------------------------
Issue #7: Carrier Frequency (LOW SEVERITY)
------------------------------------------------------------------------------
SAE J3161 Reference: Table 8, #8
  - carrierFreq = 55140 (ARFCN-ValueEUTRA-r9b)
  - This corresponds to Channel 183 in IEEE 802.11 = 5915 MHz center freq

Your Simulation (omnetpp.ini):
  - channelControl.carrierFrequency = 5905e+6 Hz (5905 MHz)

Problem:
  - 5905 MHz is the lower edge of the ITS band, not the center frequency
    of Channel 183. The correct center frequency is 5915 MHz.
  - Impact on simulation: affects path loss calculations slightly.

Fix: Set carrierFrequency to 5915e+6 Hz in omnetpp.ini.


================================================================================
3. CBR FALLBACK CONFIGURATION CONCERN
================================================================================

In sidelink_configuration.xml, the CBR-based fallback tx parameters set:
  - minSubchannel-NumberPSSCH = 1
  - maxSubchannel-NumberPSSCH = 1

SAE J3161 Section 8.6 states:
  "The radio shall reserve at least two sub-channels [REQ-J3161-SPS_002]."

If CBR is enabled and congestion is high, the fallback config would allow
single-subchannel transmission, violating this requirement.

Fix: Set minSubchannel-NumberPSSCH = 2 in all CBR fallback tx parameter
     entries in sidelink_configuration.xml.


================================================================================
4. PARAMETERS NOT VERIFIED (Out of Simulation Scope)
================================================================================

The following J3161 parameters are not directly configurable or testable
in this SimuLTE simulation but are noted for completeness:

- SLSS (Sidelink Synchronization Signal) configuration (Table 8, #24-32)
  Not modeled in simulation; perfect synchronization is assumed.

- Destination Layer-2 ID mapping (Table 5)
  BSM should use 0xFFFFFF per SAE J3161/1. Not verified in simulation.

- Peak EIRP = +33 dBm (Section 8.2.7)
  Simulation uses conducted power (23 dBm) without antenna gain modeling.

- V2X message family encoding = 0x01 (IEEE 1609) (Section 8.2.7)
  Not modeled in the simulation's simplified protocol stack.

- MTU limits: 2924 bytes for OBU, 4214 bytes for RSU (Section 8.6)
  Simulation uses packetSize = 2300, which is within OBU MTU limits.


================================================================================
5. SUMMARY TABLE
================================================================================

Severity   Count  Parameters
---------  -----  -----------------------------------------------------------
HIGH       3      MCS range, CBR/DCC disabled, SPS+One-Shot missing
MEDIUM     3      sl-ReselectAfter, BSM PPPP, RSSI-CBR threshold
LOW        1      Carrier frequency
CONCERN    1      CBR fallback min subchannel = 1 (should be 2)

Total compliant parameters:     18
Total non-compliant parameters:  7 + 1 concern


================================================================================
6. RECOMMENDED FIXES (in priority order)
================================================================================

1. sidelink_configuration.xml:
   - Change minMCS-PSSCH from 9 to 5
   - Change maxMCS-PSSCH from 16 to 11
   - Change all CBR fallback minSubchannel-NumberPSSCH from 1 to 2

2. omnetpp.ini:
   - Change useCBR from false to true
   - Change crLimit from false to true
   - Change packetDropping from false to true
   - Change reselectAfter from 1 to 6
   - Change thresholdRSSI from 10 to 9
   - Change carrierFrequency from 5905e+6 to 5915e+6

3. Mode4App.cc:
   - Change setPriority(1) to setPriority(2) for Critical BSM
     or setPriority(5) for Essential BSM

4. LteMacVUeMode4.cc (code change required):
   - Implement SPS + One-Shot scheme per J3161 Section 7.3.3 / Figure 15
   - Add OneShotCtr alongside ResourceReselectionCtr
   - OneShotCtrMin=2, OneShotCtrMax=6 for RRI >= 100ms
